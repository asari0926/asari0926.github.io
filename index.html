<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポイントカードシステム</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    
<h2>ポイント使用</h2>
<input type="text" id="userName" placeholder="名前を入力">
<input type="number" id="usePoints" placeholder="使用するポイント">
<button onclick="usePoints()">ポイントを使用</button>
<p id="result"></p>

<h2>ポイントカード</h2>
<table id="dataTable">
    <thead>
        <tr id="tableHeader"></tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbydn_ee4WGsGvyjakwo2qNji-izV2S4MhOeDv9JxcfrmmVWMGWoIzRX0v1lRKb6bZKZYg/exec";

async function usePoints() {
    const name = document.getElementById("userName").value;
    const usedPoints = document.getElementById("usePoints").value;

    if (!name || !usedPoints) {
        alert("名前とポイントを入力してください！");
        return;
    }

    const response = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, usedPoints: Number(usedPoints) })
    });

    const result = await response.json();
    document.getElementById("result").textContent = result.success
        ? `新しいポイント: ${result.newPoints}`
        : "エラー: " + result.message;

    fetchData(); // 最新データを取得（ポイントを減らした後、反映させる）
}

</script>

</body>
</html>
