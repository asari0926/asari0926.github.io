<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポイント管理</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <h1>ポイント管理システム</h1>
    
    <label for="userSelect">誰を選択:</label>
    <select id="userSelect">
        <option value="">選択してください</option>
        <option value="ママ">ママ</option>
        <option value="お父さん">お父さん</option>
    </select>

    <h2>取引履歴</h2>
    <table border="1">
        <thead>
            <tr>
                <th>日付</th>
                <th>支払い</th>
                <th>ポイント</th>
            </tr>
        </thead>
        <tbody id="historyTable">
        </tbody>
    </table>

    <h2>残りポイント: <span id="remainingPoints">-</span></h2>

    <script>
        const apiUrl = "https://script.google.com/macros/s/AKfycbyW_EOjmBnPRvUrm-ncOSEh8iBp6VKGUuTNr_jBZ-T3utOjw3-hmaejMa-qv2TeAIUZHw/exec";

        async function fetchData() {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error("データ取得に失敗しました");

                const data = await response.json();
                console.log("取得したデータ:", data); // ← デバッグ用にデータを出力
                return data;
            } catch (error) {
                console.error("エラー:", error);
                return null;
            }
        }

        document.getElementById("userSelect").addEventListener("change", async function() {
            const selectedUser = this.value;
            if (!selectedUser) {
                document.getElementById("historyTable").innerHTML = "";
                document.getElementById("remainingPoints").textContent = "-";
                return;
            }

            const data = await fetchData();
            if (!data || !data[selectedUser]) {
                console.error("選択したユーザーのデータが見つかりません");
                return;
            }

            console.log(`選択されたユーザー: ${selectedUser}`, data[selectedUser]); // ← 追加デバッグ

            const userData = data[selectedUser];

            // 残りポイントの表示
            document.getElementById("remainingPoints").textContent = userData.points;

            // 取引履歴の表示
            const historyTable = document.getElementById("historyTable");
            historyTable.innerHTML = "";

            userData.transactions.forEach(transaction => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.payment}</td>
                    <td>${transaction.points}</td>
                `;
                historyTable.appendChild(row);
            });
        });
    </script>
</body>
</html>
